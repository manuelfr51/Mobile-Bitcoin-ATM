{% extends "base.html" %}
{% load i18n %}
{% load app_extras %}
{% load staticfiles %}
{% block content %}
    <!-- <div class="container"> -->
<div id="wrap" style="position:relative;">
  <div class="container">
    <div class="row">
      <div class="col-md-5 col-sm-5">
        <h1 class="tagline">{% trans "Turn Your Phone Into a Bitcoin ATM" %}</h1>
      </div>
      <div class="col-sm-4 col-sm-offset-3 sign-up-box">
        <a href="{% url 'register_merchant' %}" class="btn btn-primary btn-lg" style="padding-right: 5px;padding-left:5px;width: 100%;">{% trans "List Your Business for Free" %}</a>
      </div>
      {% include "_play_video_modal.html" %}
    </div>
  </div>
  <a style="cursor: pointer;position:absolute;top:50%;left:50%;margin-top:-18px;margin-left:-104px;" onclick="$('#play-video-modal').modal();">
    <img src="{%static "img/play-button.png" %}"/>
  </a>
  <a style="cursor: pointer;" onclick="$('#play-video-modal').modal();">
    <p class="text-center" style="color:black;position:absolute;top:50%;left:50%;margin-top:70px;margin-left:-62px;font-weight:normal;margin-bottom: 20px;font-size: 21px;line-height: 1.4;">
      {% trans "Watch Video" %}
    </p>
  </a>
</div>
<div class="divider-bar">
  <div class="container">
    <h3 class="green-color" style="text-align:center;">{% trans "Become The Neighborhood Bitcoin Trading Post" %}</h3>
    <p class="lead text-center">
      {% blocktrans %}
        CoinSafe makes it easy for merchants around the world to buy and sell bitcoin at their store locations.
        With our easy to use mobile software and exchange partnerships, you can make money and attract new customers to your local business.
      {% endblocktrans%}
    </p>
  </div>
</div>


<div id="map_wrapper" style="height: 350px;">
    <div id="map_canvas" class="mapping" style="width: 100%; height: 100%;"></div>
</div>



<div class="divider-bar">
  <div class="container">
    <p class="lead text-center" style="padding-top:20px;">
      {% blocktrans %}
        "Now every physical store in the world can become a Bitcoin ATM with no new hardware"
      {% endblocktrans%}
      <br/>
      -Erik Voorhees, Serial entrepreneur and Bitcoin advocate
    </p>
    <br/>
    <a href="{% url 'press' %}">
      <div class="row">
        <div class="col-md-4">
          <img src="{%static "img/press_logos/geekwire_homepage.png" %}" style="margin-left: auto; margin-right: auto; display: block;">
        </div>
        <div class="col-md-4">
          <img src="{%static "img/press_logos/wsj_homepage.png" %}" style="margin-left: auto; margin-right: auto; display: block;">
        </div>
        <div class="col-md-4">
          <img src="{%static "img/press_logos/coindesk_homepage.png" %}" style="margin-left: auto; margin-right: auto; display: block; margin-top:20px;">
        </div>
      </div>
    </a>
    <br/><br/><br/>

  </div>
</div>
{% endblock content %}
{% block static_page_footer %}
  {% include "partials/_static_page_footer.html" %}
{% endblock static_page_footer %}
{% block extra_js %}
  <script>
    function toggleVideo(state) {
        // if state == 'hide', hide. Else: show video
        var div = document.getElementById("play-video-modal");
        var iframe = div.getElementsByTagName("iframe")[0].contentWindow;
        // div.style.display = state == 'hide' ? 'none' : '';
        func = state == 'hide' ? 'pauseVideo' : 'playVideo';
        iframe.postMessage('{"event":"command","func":"' + func + '","args":""}', '*');
    }

    function initializeMap() {
        var map;
        var bounds = new google.maps.LatLngBounds();
        var mapOptions = {
            mapTypeId: 'roadmap',
            scrollwheel: false
        };
                        
        // Display a map on the page
        map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
        map.setTilt(45);
            
        // Multiple Markers
        var markers = [
            ['London Eye, London', 51.503454,-0.119562],
            ['Palace of Westminster, London', 51.499633,-0.124755]
        ];
        var markers = [];
        var infoWindowContent = [];
        var i =0;
        {% for merchant in merchants_for_map %}
          markers[i] = [ '{{ merchant.business_name }}', {{ merchant.latitude_position }}, {{ merchant.longitude_position }} ];
          // markers.push([ {{ merchant.business_name }}, {{ merchant.latitude_position }}, {{ merchant.longitude_position }} ]);
          var tooltip_info = '<p class="lead text-center">{{ merchant.business_name }}</p><b>';
          html = "{{merchant.get_physical_address_html}}";
          {% for line in merchant.get_physical_address_list %}
            tooltip_info += '{{line}}<br/>';
          {% endfor %}
          {% if merchant.get_profile_url %}
            tooltip_info += '<a href="{{merchant.get_profile_url}}">Profile Link</a>'
          {% endif %}

          infoWindowContent[i] = [ tooltip_info ];
          i = i + 1;
        {% endfor %}
                            
        // Display multiple markers on a map
        var infoWindow = new google.maps.InfoWindow(), marker, i;
        
        // Loop through our array of markers & place each one on the map  
        for( i = 0; i < markers.length; i++ ) {
            var position = new google.maps.LatLng(markers[i][1], markers[i][2]);
            bounds.extend(position);
            marker = new google.maps.Marker({
                position: position,
                map: map,
                title: markers[i][0]
            });
            
            // Allow each marker to have an info window    
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                    infoWindow.setContent(infoWindowContent[i][0]);
                    infoWindow.open(map, marker);
                }
            })(marker, i));

            // Automatically center the map fitting all markers on the screen
            map.fitBounds(bounds);
        }

        // Override our map zoom level once our fitBounds function runs (Make sure it only runs once)
        var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
            // this.setZoom(14);
            google.maps.event.removeListener(boundsListener);
        });
        
    }

    $(document).ready(function(){
      // If not mobile, web video is incredibly broken
      if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        $('#play-video-modal').on('shown.bs.modal', function() {
            toggleVideo();
        })
        $('#play-video-modal').on('hidden.bs.modal', function() {
            toggleVideo('hide');
        })
      }
      
      var script = document.createElement('script');
      script.src = "http://maps.googleapis.com/maps/api/js?sensor=false&callback=initializeMap";
      document.body.appendChild(script);
      console.log('apending script');
    });

  </script>
{% endblock %}
